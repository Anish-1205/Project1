import React, { useState, useEffect } from "react"; import axios from "axios"; import { useNavigate } from "react-router-dom"; function QuizAttempt({ quizId }) { const [quiz, setQuiz] = useState(null); const [attemptId, setAttemptId] = useState(null); const [idx, setIdx] = useState(0); const [ans, setAns] = useState({}); const [loading, setLoading] = useState(true); const navigate = useNavigate(); const uid = "user_" + Date.now(); useEffect(() => { axios.get(`http://localhost:8080/api/quizzes/${quizId}`).then(r => setQuiz(r.data)).then(() => axios.post(`http://localhost:8080/api/quizzes/${quizId}/attempt/start`, {}, {params: {userId: uid}})).then(r => setAttemptId(r.data.attemptId)).finally(() => setLoading(false)); }, [quizId]); const submit = async () => { if (!ans[quiz.questions[idx].id]) { alert("Select answer"); return; } await axios.post(`http://localhost:8080/api/quizzes/attempt/${attemptId}/response`, {questionId: quiz.questions[idx].id, selectedOptionId: ans[quiz.questions[idx].id]}); if (idx < quiz.questions.length - 1) setIdx(idx + 1); else { await axios.post(`http://localhost:8080/api/quizzes/attempt/${attemptId}/submit`); navigate(`/result/${attemptId}`); } }; if (loading || !quiz) return <div>Loading...</div>; const q = quiz.questions[idx]; return <div style={{maxWidth: "800px", margin: "0 auto", padding: "30px"}}><h1>{quiz.title}</h1><div style={{height: "8px", background: "#ecf0f1", borderRadius: "4px", marginBottom: "20px"}}><div style={{height: "100%", background: "#3498db", width: `${((idx+1)/quiz.questions.length)*100}%`, transition: "width 0.3s"}}></div></div><div style={{background: "white", padding: "30px", borderRadius: "8px", marginBottom: "20px"}}><h2>{q.text}</h2><div style={{display: "flex", flexDirection: "column", gap: "15px"}}>{q.options.map(o => <label key={o.id} style={{display: "flex", alignItems: "center", padding: "15px", border: "2px solid #ecf0f1", borderRadius: "6px", cursor: "pointer"}}><input type="radio" checked={ans[q.id] === o.id} onChange={() => setAns({...ans, [q.id]: o.id})} style={{marginRight: "15px"}} /><span>{o.text}</span></label>)}</div></div><button onClick={submit} style={{padding: "12px 30px", background: "#3498db", color: "white", border: "none", borderRadius: "6px", cursor: "pointer", width: "100%"}}>{idx === quiz.questions.length - 1 ? "Finish" : "Next"}</button></div>; } export default QuizAttempt;
